<!--
 *  Copyright CSI-Piemonte - 2023
 *  SPDX-License-Identifier: GPL-3.0-or-later
-->
<div class="container">
  <div class="row mb-4">
    <button type="button" class="btn btn-link btn-xs mr-2 clickable" [routerLink]="'/home'">
      <span class="fas fa-backspace pr-2"></span>Home
    </button>
  </div>
  <br>
  <h2><em class="fas fa-cogs"></em>{{ 'header.preferenze_ente' | translate }}</h2>

  <a class="nav-link app-button" [routerLink]="'applicazioni-esterne'" role="button">
     <span>
      {{ 'app_esterne.gestisci_applicazioni' | translate }}
    </span>
  </a>

  <form [formGroup]="preferenzeEnteForm" *ngIf="preferenzeEnteForm">

    <br>
    <br>
    <div class="row">
      <div class="col-lg-11 col-sm-12 form-group">
        <label [ngClass]="{'active': preferenzeEnteForm?.controls['header'].value}" for="header">{{'common.header' |
          translate}}</label>
        <input
          [ngClass]="{ 'is-invalid': preferenzeEnteForm?.controls['header'].touched && preferenzeEnteForm?.controls['header'].invalid }"
          type="text" class="form-control" name="header" id="header" formControlName="header" maxlength="100">
        <div class="invalid-feedback" *ngIf="preferenzeEnteForm?.controls['header'].invalid">
          <p *ngIf="preferenzeEnteForm?.controls['header']?.hasError('required')">{{"errori.campo_obbligatorio" |
            translate}}
          </p>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-11 col-sm-12 form-group">
        <button type="button" (click)="inputHeader.click()" class="file-upload btn btn-outline-primary">
          <span>{{ 'header.carica_header' | translate | uppercase }}</span>
          <input type="file" accept="image/*" class="upload" #inputHeader id="logoHeader" name="logoHeader"
            (change)="onChange($event)" required>
        </button>
        <div class="file-upload-img rp_darkblue">
          <img [src]="imgURL" alt="" height="50">
        </div>
        <input
          [ngClass]="{ 'is-invalid': (preferenzeEnteForm?.controls['logo'].touched && preferenzeEnteForm?.controls['logo'].invalid)
          || preferenzeEnteForm?.controls['sizeHeader'].invalid
          || preferenzeEnteForm?.controls['heightHeader'].invalid || preferenzeEnteForm?.controls['widthHeader'].invalid}"
          type="text" hidden>
        <div class="invalid-feedback"
          *ngIf="(preferenzeEnteForm?.controls['logo'].touched && preferenzeEnteForm?.controls['logo'].invalid)
            || preferenzeEnteForm?.controls['sizeHeader'].invalid
            || preferenzeEnteForm?.controls['widthHeader'].invalid || preferenzeEnteForm?.controls['heightHeader'].invalid">
          <p *ngIf="preferenzeEnteForm?.controls['logo']?.hasError('required')">
            {{"errori.campo_obbligatorio" | translate}}
          </p>
          <p *ngIf="preferenzeEnteForm?.controls['sizeHeader']?.hasError('max')">
            {{"errori.grandezza_upload_file_superata" | translate:{v1: maxSize / 1000} }}
          </p>
          <p
            *ngIf="preferenzeEnteForm?.controls['heightHeader']?.hasError('max') || preferenzeEnteForm?.controls['widthHeader']?.hasError('max')">
            {{"errori.grandezza_pixel_upload_file_superata" | translate:{v1: maxNumOfPixels} }}
          </p>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-11 col-sm-12 form-group">
          <button type="button" (click)="inputFooter.click()" class="file-upload btn btn-outline-primary">
            <span>{{ 'footer.carica_footer_sinistra' | translate | uppercase }}</span>
            <input type="file" id="logoFooter" name="logoFooter" class="upload" #inputFooter (change)="onChange($event)"
              accept="image/*" required>
          </button>
        <div class="file-upload-img rp_darkblue">
          <img [src]="imgURLFooter" alt="" height="50">
        </div>
        <input
          [ngClass]="{ 'is-invalid': (preferenzeEnteForm?.controls['logoFooter'].touched && preferenzeEnteForm?.controls['logoFooter'].invalid)
          || preferenzeEnteForm?.controls['sizeFooter'].invalid
          || preferenzeEnteForm?.controls['heightFooter'].invalid || preferenzeEnteForm?.controls['widthFooter'].invalid}"
          type="text" hidden>
        <div class="invalid-feedback"
          *ngIf="(preferenzeEnteForm?.controls['logoFooter'].touched && preferenzeEnteForm?.controls['logoFooter'].invalid)
            || preferenzeEnteForm?.controls['sizeFooter'].invalid
            || preferenzeEnteForm?.controls['widthFooter'].invalid || preferenzeEnteForm?.controls['heightFooter'].invalid">
          <p *ngIf="preferenzeEnteForm?.controls['logoFooter']?.hasError('required')">
            {{"errori.campo_obbligatorio" | translate}}
          </p>
          <p *ngIf="preferenzeEnteForm?.controls['sizeFooter']?.hasError('max')">
            {{"errori.grandezza_upload_file_superata" | translate:{v1: maxSize / 1000} }}
          </p>
          <p
            *ngIf="preferenzeEnteForm?.controls['heightFooter']?.hasError('max') || preferenzeEnteForm?.controls['widthFooter']?.hasError('max')">
            {{"errori.grandezza_pixel_upload_file_superata" | translate:{v1: maxNumOfPixels} }}
          </p>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-11 col-sm-12 form-group">
        <button type="button" (click)="inputFooterCentrale.click()" class="file-upload btn btn-outline-primary">
          <span>{{ 'footer.carica_footer_centrale' | translate | uppercase }}</span>
          <input type="file" id="logoFooterCentrale" name="logoFooterCentrale" class="upload" #inputFooterCentrale (change)="onChange($event)"
            accept="image/*" required>
        </button>
        <div class="file-upload-img rp_darkblue">
          <img [src]="imgURLFooterCentrale" alt="" height="50">
        </div>
        <input
          [ngClass]="{ 'is-invalid': (preferenzeEnteForm?.controls['logoFooterCentrale'].touched && preferenzeEnteForm?.controls['logoFooterCentrale'].invalid)
          || preferenzeEnteForm?.controls['sizeFooterCentrale'].invalid
          || preferenzeEnteForm?.controls['heightFooterCentrale'].invalid || preferenzeEnteForm?.controls['widthFooterCentrale'].invalid}"
          type="text" hidden>
        <div class="invalid-feedback"
          *ngIf="(preferenzeEnteForm?.controls['logoFooterCentrale'].touched && preferenzeEnteForm?.controls['logoFooterCentrale'].invalid)
            || preferenzeEnteForm?.controls['sizeFooterCentrale'].invalid
            || preferenzeEnteForm?.controls['widthFooterCentrale'].invalid || preferenzeEnteForm?.controls['heightFooterCentrale'].invalid">
          <p *ngIf="preferenzeEnteForm?.controls['logoFooterCentrale']?.hasError('required')">
            {{"errori.campo_obbligatorio" | translate}}
          </p>
          <p *ngIf="preferenzeEnteForm?.controls['sizeFooterCentrale']?.hasError('max')">
            {{"errori.grandezza_upload_file_superata" | translate:{v1: maxSize / 1000} }}
          </p>
          <p
            *ngIf="preferenzeEnteForm?.controls['heightFooterCentrale']?.hasError('max') || preferenzeEnteForm?.controls['widthFooterCentrale']?.hasError('max')">
            {{"errori.grandezza_pixel_upload_file_superata" | translate:{v1: maxNumOfPixels} }}
          </p>
        </div>
      </div>
    </div>


    <div class="row">
      <div class="col-lg-11 col-sm-12 form-group">
        <button type="button" (click)="inputFooterDestra.click()" class="file-upload btn btn-outline-primary">
          <span>{{ 'footer.carica_footer_destra' | translate | uppercase }}</span>
          <input type="file" id="logoFooterDestra" name="logoFooterDestra" class="upload" #inputFooterDestra (change)="onChange($event)"
            accept="image/*" required>
        </button>
        <div class="file-upload-img rp_darkblue">
          <img [src]="imgURLFooterDestra" alt="" height="50">
        </div>
        <input
          [ngClass]="{ 'is-invalid': (preferenzeEnteForm?.controls['logoFooterDestra'].touched && preferenzeEnteForm?.controls['logoFooterDestra'].invalid)
          || preferenzeEnteForm?.controls['sizeFooterDestra'].invalid
          || preferenzeEnteForm?.controls['heightFooterDestra'].invalid || preferenzeEnteForm?.controls['widthFooterDestra'].invalid}"
          type="text" hidden>
        <div class="invalid-feedback"
          *ngIf="(preferenzeEnteForm?.controls['logoFooterDestra'].touched && preferenzeEnteForm?.controls['logoFooterDestra'].invalid)
            || preferenzeEnteForm?.controls['sizeFooterDestra'].invalid
            || preferenzeEnteForm?.controls['widthFooterDestra'].invalid || preferenzeEnteForm?.controls['heightFooterDestra'].invalid">
          <p *ngIf="preferenzeEnteForm?.controls['logoFooterDestra']?.hasError('required')">
            {{"errori.campo_obbligatorio" | translate}}
          </p>
          <p *ngIf="preferenzeEnteForm?.controls['sizeFooterDestra']?.hasError('max')">
            {{"errori.grandezza_upload_file_superata" | translate:{v1: maxSize / 1000} }}
          </p>
          <p
            *ngIf="preferenzeEnteForm?.controls['heightFooterDestra']?.hasError('max') || preferenzeEnteForm?.controls['widthFooterDestra']?.hasError('max')">
            {{"errori.grandezza_pixel_upload_file_superata" | translate:{v1: maxNumOfPixels} }}
          </p>
        </div>
      </div>
    </div>


    <div class="row">
      <div class="col-lg-11 col-sm-12 form-group">
        <label [ngClass]="{'active': preferenzeEnteForm?.controls['dimensioneMassimaAllegatiEmail'].value}" for="dimensioneMassimaAllegatiEmail">
          Dimensione massima allegati email</label>
        <input
          [ngClass]="{ 'is-invalid': preferenzeEnteForm?.controls['dimensioneMassimaAllegatiEmail'].touched && preferenzeEnteForm?.controls['dimensioneMassimaAllegatiEmail'].invalid }"
          type="number" min="0" step="1"
          class="form-control" name="dimensioneMassimaAllegatiEmail" id="dimensioneMassimaAllegatiEmail" formControlName="dimensioneMassimaAllegatiEmail"
        >
        <div class="invalid-feedback" *ngIf="preferenzeEnteForm?.controls['dimensioneMassimaAllegatiEmail'].invalid">
          <p *ngIf="preferenzeEnteForm?.controls['dimensioneMassimaAllegatiEmail']?.hasError('required')">{{"errori.campo_obbligatorio" |
            translate}}
          </p>
          <p *ngIf="preferenzeEnteForm?.controls['dimensioneMassimaAllegatiEmail']?.hasError('min')">Devi inserire un valore maggiore o uguale a zero
          </p>
        </div>
      </div>
    </div>

    <hr>
    <br>
    <div class="row mt-3">
        <h2>Impostazioni Widget</h2>
    </div>
      <div class="row mt-3">
        <div class="col-6 col-lg-5">
          <span class="mb-3">Widget associati</span>
          <div  cdkDropList
            #widgetAssociatiList="cdkDropList" [cdkDropListData]="valorePreferenzeEnte.widgets" [cdkDropListConnectedTo]="[widgetDisponibiliList]"
            class="example-list mt-3" (cdkDropListDropped)="drop($event)">
            <div class="example-box"
              *ngFor="let widget of widgetAssociati"
              cdkDrag>
              <div class="w-100">
                <div class="row">
                    <p class="text">
                      {{widget}}
                    </p>
                </div>
              </div>
            </div>
            <div class="example-box empty-tip" *ngIf="!(valorePreferenzeEnte.widgets?.length)">
              <div>
                <p class="text">
                  <span class="fas fa-times mr-2"></span>
                  <em>Nessun widget associato.</em>
                  <br/>
                  <em class="a-bit-smaller">Trascina qui un widget dall'elenco sulla destra per associarlo all'ente.</em>
                </p>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12 col-lg-1 text-center">
          <span class="d-none d-lg-block pt-5">
            <span class="fas fa-exchange-alt"></span>
          </span>
        </div>
        <div class="col-6 col-lg-5">
          <span class="mb-3">Widget disponibili</span>
          <div cdkDropList #widgetDisponibiliList="cdkDropList" [cdkDropListData]="widgetDisponibili"
            [cdkDropListConnectedTo]="[widgetAssociatiList]" class="example-list mt-3" (cdkDropListDropped)="drop($event)">
            <div class="example-box" *ngFor="let widget of widgetsDisponibili" cdkDrag>
              <div>
                <p class="text">
                  {{widget}}
                </p>
              </div>
            </div>
          </div>
        </div>

      </div>

    <div class="row mt-3">
      <div class="col-lg-5 col-sm-12 form-group">
          <div class="form-check form-check-inline">
            <input id="modificabile" formControlName="modificabile" type="checkbox">
            <label class="inline-label mr-4" for="modificabile" >Modificabile</label>
          </div>
      </div>
    </div>

    <br class="mt-3 mb-3">
    <hr>

  </form>
  <br>
  <h2>{{"preferenze.impostazioni_firma" | translate}}</h2>
  <br>
  <br>
  <app-impostazioni-firma #impostazioniFirma [obbligatorietaCampi]="obbligatorietaCampi" ></app-impostazioni-firma>

  <hr>
  <br>
  <h2>{{"preferenze.impostazioni_firma_fea" | translate}}</h2>
  <br>
  <br>
  <div class="row form-group">
    <div class="col-lg-11 col-sm-12 form-group">

            <button type="button" (click)="inputImmagineFea.click()" class="file-upload btn btn-outline-primary">
              <span>{{ "preferenze.carica_icona_fea" | translate }}</span>
              <input type="file" accept="image/*" class="upload" #inputImmagineFea id="immagineFea" name="immagineFea"
                (change)="onChange($event)">
            </button>

            <div class="file-upload-img rp_darkblue">
              <img [src]="imgURLFea" alt="" height="50">
            </div>

            <input
            [ngClass]="{ 'is-invalid': (preferenzeEnteForm?.controls['immagineFea'].touched && preferenzeEnteForm?.controls['immagineFea'].invalid)
            || preferenzeEnteForm?.controls['sizeimmagineFea'].invalid
            || preferenzeEnteForm?.controls['heightimmagineFea'].invalid || preferenzeEnteForm?.controls['widthimmagineFea'].invalid}"
            type="text" hidden>
          <div class="invalid-feedback"
            *ngIf="(preferenzeEnteForm?.controls['immagineFea'].touched && preferenzeEnteForm?.controls['immagineFea'].invalid)
              || preferenzeEnteForm?.controls['sizeimmagineFea'].invalid
              || preferenzeEnteForm?.controls['widthimmagineFea'].invalid || preferenzeEnteForm?.controls['heightimmagineFea'].invalid">

            <p *ngIf="preferenzeEnteForm?.controls['sizeimmagineFea']?.hasError('max')">
              {{"errori.grandezza_upload_file_superata" | translate:{v1: feaMaxSize / 1000} }}
            </p>
            <p
              *ngIf="preferenzeEnteForm?.controls['heightimmagineFea']?.hasError('max') || preferenzeEnteForm?.controls['widthimmagineFea']?.hasError('max')">
              {{"errori.grandezza_pixel_upload_file_superata" | translate:{v1: feaMaxNumOfPixels} }}
            </p>
          </div>
      </div>

  </div>



  <div class="row">
    <div class="col-12 text-right">
      <button type="button" class="btn btn-sm btn-success" (click)="salva()" [disabled]="!preferenzeEnteForm?.valid">
        {{"common.salva" | translate}}
      </button>
      &nbsp;
      <button type="button" class="btn btn-sm btn-danger" (click)="resetFields()">
        {{"common.annulla_modifiche" | translate}}
      </button>
    </div>
  </div>
</div>

<router-outlet></router-outlet>
